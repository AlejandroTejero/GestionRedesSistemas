<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>practica01</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="pandoc.css" />
</head>
<body>
<h1 id="memoria-práctica-1">MEMORIA PRÁCTICA 1:</h1>
<h2 id="práctica-1.1.-directorios-de-las-prácticas">Práctica 1.1.
Directorios de las prácticas</h2>
<ol type="1">
<li>Crea el directorio en home:</li>
</ol>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">-s</span> <span class="at">-c</span> pandoc.css test_markdown.md <span class="at">-o</span> test_markdown_css.html</span></code></pre></div>
<ol start="2" type="1">
<li>Creo un symlink a la carpeta con:</li>
</ol>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> <span class="op">&lt;</span>ruta_origen<span class="op">&gt;</span> <span class="op">&lt;</span>ruta_destino<span class="op">&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ln</span> <span class="at">-s</span> ~/lagrs ~/Escritorio</span></code></pre></div>
<ol start="3" type="1">
<li>Ponle permisos rwx:</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 700 ~/largs</span></code></pre></div>
<ol start="4" type="1">
<li>Crea el directorio:</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/largs/practica01</span></code></pre></div>
<ol start="5" type="1">
<li>Crea el fichero:</li>
</ol>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> ~/largs/practica01.md</span></code></pre></div>
<ol start="6" type="1">
<li>Crea un directorio images:</li>
</ol>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/largs/images</span></code></pre></div>
<h2 id="práctica-1.2.-uso-básico-de-vi">Práctica 1.2. Uso básico de
vi</h2>
<ol type="1">
<li>Crea fichero ejemplo.md con vim:</li>
</ol>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vim</span> ~/largs/practica01/ejemplo.md</span></code></pre></div>
<ol start="2" type="1">
<li>Pulsamos a o i para modo escritura, esc para salir del modo y
escribimos :wq para cerrar y guardar o :q! para salir sin guardar.</li>
</ol>
<h2 id="práctica-1.3.-uso-de-un-editor-sin-gráficos">Práctica 1.3. Uso
de un editor sin gráficos</h2>
<p>1.3.1. De momento me quedaré con el editor de texto “vim”, ya que por
foros dicen que es un básico y que es tan usado que en cualquier sistema
Unix viene de forma predeterminada. Aunque al comienzo parece un poco
difícil creo que una vez consigas dominarla tiene un gran potencial.</p>
<p>1.3.2 Algunos atajos imprescindibles: a: Pasar de modo orden a modo
insertar R: Pasar de modo orden a modo reemplazar Esc: Volver al modo
orden x: Eliminar un carácter :wq : Guardar el fichero y salir :q! :
Salir sin guardar el fichero</p>
<p>Luego existen otras órdenes interesantes: :r nombre: Lee el fichero
con ese nombre :w nombre: Escribe el fichero ctrl r: Rehacer lo último
desecho u: Deshace el último cambio</p>
<h2 id="práctica-1.4.-markdown">Práctica 1.4. Markdown</h2>
<ol type="1">
<li>Preparamos el documento con:</li>
</ol>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> <span class="op">&lt;</span>direccion/nombre_archivo.md<span class="op">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> ~/lagrs/practica01/test_markdown.md</span></code></pre></div>
<ol start="2" type="1">
<li>Para abrir el documento escribiremos:</li>
</ol>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> <span class="op">&lt;</span>direccion/nombre_archivo.md<span class="op">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> ~/lagrs/practica01/test_markdown.md</span></code></pre></div>
<ol start="3" type="1">
<li><p>Una vez abierto podremos escribir en formato markdown, ejemplo en
el md.</p></li>
<li><p>Primero debemos crear el scrip en el home, con el nombre de
clean_md.sh, para limpiar el fichero con pandoc pondremos:</p></li>
</ol>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>direccion_clean/clean_md.sh<span class="op">&gt;</span> <span class="op">&lt;</span>Direccion <span class="ex">Archivo/nombre_archivo</span><span class="op">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/clean_md.sh</span> ~/lagrs/practica01/test_markdown.md</span></code></pre></div>
<ul>
<li>Tanto clean como test_markdown tienen que tener la direccion delante
si no se encuentran en el mismo sitio, el .sh debe estar en el home. En
este caso el terminal esta en el home asi que solo ponemos la direccion
de test_markdown</li>
</ul>
<figure>
<img src="images/clean_md.png" alt="Ejemplo comando clean_md.sh" />
<figcaption aria-hidden="true"><strong>Ejemplo comando
clean_md.sh</strong></figcaption>
</figure>
<p>Esto pasará el archivo de markdown a markdown, colocando y limpiando
el texto escrito.</p>
<ol start="5" type="1">
<li>Para generar una versión html del .md pondremos:</li>
</ol>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">-s</span> <span class="at">-c</span> <span class="op">&lt;</span>direccion_pandoc_css<span class="op">&gt;</span> <span class="op">&lt;</span>direccion_archivo<span class="op">&gt;</span> -o <span class="op">&lt;</span>direccion_y_nombre.html<span class="op">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">-s</span> <span class="at">-c</span> pandoc.css test_markdown.md <span class="at">-o</span> test_markdown_css.html</span></code></pre></div>
<ul>
<li>El primer md sera el nombre de nuestro archivo mientras que el
siguiente será el nombre del nuevo archivo html. En este caso tenemos el
css de pandoc en el archivo llamado pandoc.css, por lo que no es el css
base. Ahora el terminal está en la carpeta home, asi que ponemos la
dirección del archivo pandoc, del archivo test_markdown y donde quieres
que se guarde el html.</li>
</ul>
<figure>
<img src="images/pandoc.png" alt="Ejemplo de pandoc" />
<figcaption aria-hidden="true"><strong>Ejemplo de
pandoc</strong></figcaption>
</figure>
<p><embed src="https://gsyc.urjc.es/~mortuno/pandoc.css" /> <embed
src="https://gsyc.urjc.es/~mortuno/md.css" /></p>
<p>Arriba a la izq tenemos el <em>css de pandoc</em>, y a la derecha el
<em>css de killercup</em>.</p>
<p>Si queremos usar la css de killercup deberiamos crear un
killercup.css con ese codigo y cambiar el comando a:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">-s</span> <span class="at">-c</span> <span class="op">&lt;</span>direccion_killercup_css<span class="op">&gt;</span> <span class="op">&lt;</span>direccion_archivo<span class="op">&gt;</span> -o <span class="op">&lt;</span>direccion_y_nombre.html<span class="op">&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pandoc</span> <span class="at">-s</span> <span class="at">-c</span> killercup.css test_markdown.md <span class="at">-o</span> test_markdown_css.html</span></code></pre></div>
<h2 id="práctica-1.5.-gestión-de-contraseñas">Práctica 1.5. Gestión de
contraseñas</h2>
<ol type="1">
<li>Cifrado con gpg Creo un txt con:</li>
</ol>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> <span class="op">&lt;</span>Direccion y nombre arhivo.txt<span class="op">&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> ~/lagrs/PruebaGpg.txt</span></code></pre></div>
<p>E introduzco las contraseñas dentro. Ahora ciframos con:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gpg</span> <span class="at">-c</span> PruebaGpg.txt</span></code></pre></div>
<p>Una vez cifrado el txt lo podemos descrifrar con:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gpg</span> PruebaGpg.txt.gpg</span></code></pre></div>
<figure>
<img src="images/PruebaGpg.png" alt="PruebaGpg" />
<figcaption aria-hidden="true"><strong>PruebaGpg</strong></figcaption>
</figure>
<ol start="2" type="1">
<li>Cifrado con LibreOffice</li>
</ol>
<p>Abriremos un archivo de escritura, escribiremos nuestra contraseña y
al guardar le daremos a añadir cifrado.</p>
<figure>
<img src="images/PruebaOffice.png" alt="PruebaOffice" />
<figcaption
aria-hidden="true"><strong>PruebaOffice</strong></figcaption>
</figure>
<ol start="3" type="1">
<li>Cifrado con KeePassX</li>
</ol>
<p>Al crear el archivo te pedira que crees la contraseña de entrada, una
vez creada puedes guardar tus contraseñas. Cada vez que quieras inciar
el archivo tendras que meter esta contraseña inicial.</p>
<figure>
<img src="images/PruebaKPX.png" alt="PruebaKPX" />
<figcaption aria-hidden="true"><strong>PruebaKPX</strong></figcaption>
</figure>
<h2 id="práctica-1.6.-secret-sharing">Práctica 1.6. Secret Sharing</h2>
<p>Para crear una contraseña con sss de 6 trozos, de forma que con
juntar 4 de esos trozos sirva para recomponerla hemos de hacer lo
siguiente:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sss-split</span> <span class="at">-t</span> 4 <span class="at">-n</span> 6</span></code></pre></div>
<p>Indica que con 4 de esos 6 trozos es suficiente. Después nos pedira
que introduzcamos la contraseña y nos dará 6 fragmentos.</p>
<figure>
<img src="images/ssss-split.png" alt="Ejemplo ssss" />
<figcaption aria-hidden="true"><strong>Ejemplo
ssss</strong></figcaption>
</figure>
<p>Para restaurar la contraeña hemos de introducir:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sss-combine</span> <span class="at">-t</span> 4</span></code></pre></div>
<p>Nos pedirá que introduzcamos 4 fragmentos de los 6 anteriores, no
hace falta que sean en orden. Ejemplo:</p>
<figure>
<img src="images/ssss-combine.png" alt="Ejemplo restauración ssss" />
<figcaption aria-hidden="true"><strong>Ejemplo restauración
ssss</strong></figcaption>
</figure>
<h2 id="práctica-1.7.-vagrant">Práctica 1.7. Vagrant</h2>
<ol type="1">
<li>Primero debemos crear el project directory:</li>
</ol>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/lagrs/vbox01</span></code></pre></div>
<ol start="2" type="1">
<li>Iniciaremos la app virtualbox con:</li>
</ol>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">virtualbox</span></span></code></pre></div>
<ul>
<li>Debemos cambiar el directorio por
<strong>/var/tmp/alexteje</strong>, aqui se guardara la maquina virtual.
Es un sitio de guardado temporal, ya que la maquina virtual ocupa mucho
espacio.</li>
</ul>
<ol start="3" type="1">
<li>Para crear una maquina virtual de ubuntu 24.04 pondremos (en
~/lagrs/vbox01):</li>
</ol>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> init bento/ubuntu-24.04</span></code></pre></div>
<ul>
<li>Este comando crea un vagrantfile, que contiene los detalles de la
creacion de la maquina. Aqui es donde puedes cambiar el nombre de la
maquina entre otras cosas.</li>
<li>Esto solo se hace una vez, es para crear la maquina virtual de
inicio, si ya la creaste en otro momento solo tienes que levatarla con
up y meterte con ssh</li>
<li>Tardara un poco en crearse, pero una vez se haya creado la maquina
virtual debemos levantarla</li>
</ul>
<ol start="4" type="1">
<li>Para ello ponemos:</li>
</ol>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> up</span></code></pre></div>
<ol start="5" type="1">
<li>Despues entraremos a la maquina virtual con:</li>
</ol>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> ssh</span></code></pre></div>
<ol start="6" type="1">
<li>Ya estaras dentro de la maquina <strong>vagrant@vagrant</strong>,
dentro tienes acceso a la carpeta vagrant:</li>
</ol>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> vagrant</span></code></pre></div>
<ul>
<li><p>Esta carpeta es <strong>MUY IMPORTANTE</strong> ya que esta
conectada con el home de tu usario (home/alexteje) y todo lo que guardes
en esta carpeta se guardara en tu home. Desde tu usario normal tambien
podras editar estos proyectos de forma que se guardara en la maquina
virtual. Esto se hace por si se borra la maquina virtual poder seguir
teniendo las cosas guardadas.</p></li>
<li><p>Todos estos comandos debemos hacerlos en el project directory, en
ese caso en vbox01, es decir, cd lagrs/vbox01. Sino no se estaria
levantando la maquina virtual correcta. Cada maquina tiene su propia
carpeta/project directory.</p></li>
</ul>
<ol start="7" type="1">
<li>Para cambiar el nombre de la maquina a
<strong>vagratn@vbox01</strong> deberemos añadir en el fichero
vagrantfile:</li>
</ol>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> vagrantfile</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">config.vm.hostname</span> = <span class="st">&quot;vbox01&quot;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="ex">config.vm.define</span> vbox01</span></code></pre></div>
<ol start="8" type="1">
<li>Para apagar la maquina virtual iremos al terminal del project
directory (~/lagrs/vbox01), podemos apagarla, dormirla o
eliminarla:</li>
</ol>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> halt</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> suspend</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> destroy</span></code></pre></div>
<h2 id="practica-1.8.-usuarios-y-grupos">Practica 1.8. Usuarios y
Grupos</h2>
<ol type="1">
<li><p>Primero debemos iniciar la maquina virtual, nos meteremos en
~/lagrs/vbox01 y ejecutaremos levataremos la maquina virtual con
<strong>vagrant up</strong>, despues accederemos con <strong>vagrant
ssh</strong>.</p></li>
<li><p>Para crear un nuevo usuario debemos poner:</p></li>
</ol>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> adduser alexteje</span></code></pre></div>
<ol start="3" type="1">
<li>Abriremos sesion con el nuevo usuario con unos de estos
comandos:</li>
</ol>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span></code></pre></div>
<ol start="4" type="1">
<li>Como el usuario no tiene privilegios e intentamos ejecutar sudo apt
update por ejemplo, nos pedira una contraseña pero al introducirla el
proceso fallara</li>
<li>Para poder ejecutar comandos sudo debemos volver al usario principal
y darle privilegios:</li>
</ol>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> usuario_princial</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> usermod <span class="at">-aG</span> sudo alexteje</span></code></pre></div>
<ol start="6" type="1">
<li>Volvemos a la sesion creada con <strong>su alexteje</strong> y ahora
si podremos ejecutar sudo apt update</li>
<li>Crearemos dos grupos con nombres cualquiera y meteremos el usuario
en estos grupos con:</li>
</ol>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> groupadd nombregrupo</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span> alexteje</span></code></pre></div>
<ol start="8" type="1">
<li>La orden <strong>newgrp</strong> cambia el grupo primario
temporalmente por el que elijas. Si ejecutamos:</li>
</ol>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">newgrp</span> grupo1</span></code></pre></div>
<p>Podremos comprobarlo con el comando <strong>id</strong>.</p>
<ol start="9" type="1">
<li>Para salir de la sesion ejecutaremos <strong>exit</strong></li>
</ol>
<h2 id="practica-1.9.-ssh-sin-contraseñas">Practica 1.9. Ssh sin
contraseñas</h2>
<ul>
<li>En esta parte configuraremos la cuenta de laboratorio para poder
entrar desde cualquier otra sin necesidad de escribir contraseñas.</li>
</ul>
<p>-Primero ejecutaremos el comando:</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span></span></code></pre></div>
<p>Esto nos generara una clave publica/privada que la guardara en el
archivo /.ssh/id_ed25519 (Se puede abrir y ver la contraseña)</p>
<ul>
<li>Al ejecutar ese comando nos deja cifrar la contraseña aleatoria con
un contraseña nuestra (passphrase) que podremos o no crear. Al seguir
creara una identificacion que se guardara en ./ssh/id_ed25519.pub</li>
<li>Al seguir saldra un dibujo aleatorio que nos indica que ya ha la
contraseña ha sido creada correctamente, si deseamos en algun momento
crear otra diferente habria que seguir estos pasos y al llegar al dibujo
se creara otro distinto.</li>
<li>Para acceder a los archivos anteriores es conveniente acceder con
uno de estos dos comandos:</li>
</ul>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">view</span> nombre_archivo</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> nombre_archivo</span></code></pre></div>
<p>View para evitar modificar sin querer y cat para que salga por
terminal.</p>
<ul>
<li><p>Todo esto es para crear la clave publica/privada, solo hay que
hacerlo una vez.</p></li>
<li><p><strong>Acceder sin contraseña</strong>: Para poder acceder a
otro ordenador sin contraseña debemos añadir esta contraseña que
acabamos de crear (/.ssh/id_ed25519.pub) en el .ssh/authorized_keys del
ordenador al que queremos acceder.</p></li>
<li><p>Ahora necesitamos dar permisos. Mas concretamente estos:</p></li>
</ul>
<ol type="1">
<li>Dueño : Permisos 700</li>
<li>Ssh : Permisos 700</li>
<li>Ficheros de ssh: Permisos 600</li>
<li>Ademas necesitaremos que los ficheros pertenezcan al usuario y
tengan como grupo el usuario</li>
</ol>
<ul>
<li>Para poder ver los permisos tenemos estos comandos: Comandos de los
archivos de la carpeta ssh, una vez que estamos en ese directorio:</li>
</ul>
<div class="sourceCode" id="cb33"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span></span></code></pre></div>
<p>Si no estamos en el directorio ssh:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> .ssh</span></code></pre></div>
<p>Permisos de la carpeta ssh, necestiamos estar en home (Escritorio,
lagrs,Musica… ):</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-ld</span> .sshls <span class="at">-l</span> .ssh</span></code></pre></div>
<figure>
<img src="images/Permisos.png" alt="Observacion de permisos" />
<figcaption aria-hidden="true"><strong>Observacion de
permisos</strong></figcaption>
</figure>
<h2 id="practica-1.10.-ssh-sin-contraseñas">Practica 1.10. Ssh sin
contraseñas</h2>
<ul>
<li><p>Para configurar la maquina para acceder sin contraseña debemos
añadir el /.ssh/id_ed25519.pub en el /.ssh/authorized_keys de la maquina
virtual.</p></li>
<li><p>Para probar los ficheros tar, he creado con touch un archivo
llamado Prueba.md y he escrito dentro de el.</p></li>
<li><p>Para comprimirlo a .tar debemos</p></li>
</ul>
<div class="sourceCode" id="cb36"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-cvf</span> <span class="op">&lt;</span>NombreTar.tar<span class="op">&gt;</span> <span class="op">&lt;</span>Direccion y nombre del archivo a comprimir<span class="op">&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-cvf</span> Prueba_tar.tar Prueba.md</span></code></pre></div>
<ul>
<li>Con view podras obrservar el nombre del archivo y su interior el
contenido</li>
<li>Para descomprimir usaremos</li>
</ul>
<div class="sourceCode" id="cb37"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-tf</span> <span class="op">&lt;</span>NombreArchivoTar.tar<span class="op">&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-tf</span> archivo.tar</span></code></pre></div>
<h2 id="practica-1.10bis.-provisionamineto-del-box">Practica 1.10bis.
Provisionamineto del box</h2>
<p>-En esta practica craremos el provisionamineto de la maquina virtual
para poder cceder desde cualquier maquina de la universidad. Para ello
deberemos realizar estos pasos al iniciar el box desde una maquina
diferente:</p>
<ol type="1">
<li>Iniciar virtualbox y eliminar la vbox01</li>
<li>Levantar una nueva maquina con vafrant up</li>
</ol>
<p><strong>Recordatorio</strong>: Si queremos editar el Vagrantfile e
actualizar la maquina debemos realizar:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> destroy</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> up</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> ssh</span></code></pre></div>
<ul>
<li>Para realizar el provisionamineto haremos lo siguiente:</li>
</ul>
<figure>
<img src="images/Vagrantfile.png" alt="VagrantFile" />
<figcaption aria-hidden="true"><strong>VagrantFile</strong></figcaption>
</figure>
<ul>
<li>Añadimos el usuario de esta forma (adduser) ya que le crea el
directorio personal (con useradd hay que añadir las lineas
comentadas).</li>
<li>Gecos se refiere a informacion extra del usuario como su oficina… de
momento no nos interesa. El disbled password nos permite crearlo sin
pedir la contraseña inicial para crearlo, la contraseña del usuario
habra que introducirla cuando se inicie. Y por ultimo el echo chpassw
sirve para establecer la contraseña del usuario.</li>
<li>El directorio ssh del usuario no estara crearlo, asi que debemos
crearlo y añadirle el authorized_key. deontro hay que añadir la clave
con:</li>
</ul>
<div class="sourceCode" id="cb39"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> ~/.ssh/authorized_keys usuario@ip_de_maquina_virtual:~/.ssh/</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span>  ~/.ssh/authorized_keys usuario@ip_de_maquina_virtual:~/.ssh/</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> solo funciona en el mismo sistema, scp para copiar de un sist a otro <span class="er">(</span><span class="ex">pc-vbox01</span><span class="kw">)</span></span></code></pre></div>
<ul>
<li>Ademas de esto, para poder acceder sin contraseña debemos darle
permisos al usuario con chown y chgrp a los directorios creados.</li>
</ul>
<h2 id="practica-1.11.-scp">Practica 1.11. Scp</h2>
<ol type="1">
<li>Accederemos al directorio tmp de mi maquina y crearemos un archivo
de prueba para enviarlo con scp a otra maquina, de esta forma:</li>
</ol>
<div class="sourceCode" id="cb40"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> <span class="op">&lt;</span>nombre_fichero<span class="op">&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> Prueba_scp.md alexteje@f-l3109-pc03.aulas.eif.urjc.es:/tmp</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="op">&lt;</span>nombre_fichero<span class="op">&gt;</span> <span class="op">&lt;</span>usuario<span class="op">&gt;</span>@<span class="op">&lt;</span>ip_del_vecino<span class="op">&gt;</span>:/tmp</span></code></pre></div>
<ul>
<li>Al hacer scp por primera vez con un vecino nos saldra un mensaje de
que se guarda la claves de ese host en /.ssh/known_hosts</li>
<li>Si entramos al puesto vecino con ssh podremos ver el archivo en
/tmp</li>
</ul>
<ol start="2" type="1">
<li>Creamos el directorio en /tmp del vecino con nuestro nombre de
usuario, creamos algunos ficheros y lo mandamos a nuestro puesto
habitual:</li>
</ol>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> alexteje@<span class="op">&lt;</span>ip_vecina<span class="op">&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> alexteje</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> alexteje</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> <span class="op">&lt;</span>archivo.md<span class="op">&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> .. <span class="er">(</span><span class="bu">cd</span> /tmp<span class="kw">)</span> <span class="ex">--</span><span class="op">&gt;</span> Para situarnos en /tmp/</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> alexteje alexteje@f-l3109-pc07.aulas.eif.urjc.es:/tmp</span></code></pre></div>
<ul>
<li>el -r sera neccesario para copiar un directorio, antes como era un
solo fichero (Prueba_scp.md) no era neccesario</li>
</ul>
<ol start="3" type="1">
<li><strong>Importante (ip vbox01)</strong>: Para copiar ficheros y
archivos necesitamos saber la direccion ip de la maquina virtual, si
realizamos:</li>
</ol>
<div class="sourceCode" id="cb42"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> a</span></code></pre></div>
<p>Saldran los datos de la maquina, buscando en eth0 encontramos la
dirrecion mas concretamente donde pone inet (inet 10.0.2.15/24), asi que
pondremos 10.0.2.15</p>
<ul>
<li>Para copiar el fichero haremos</li>
</ul>
<div class="sourceCode" id="cb43"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="op">&lt;</span>nombre_del_archivo<span class="op">&gt;</span> vagrant@10.0.2.15:/tmp</span></code></pre></div>
<ol start="4" type="1">
<li>Y para copiar el fichero haremos</li>
</ol>
<div class="sourceCode" id="cb44"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> <span class="op">&lt;</span>nombre_del_directorio<span class="op">&gt;</span> vagrant@10.0.2.15:/tmp</span></code></pre></div>
<p><strong>Error a saber:</strong></p>
<ul>
<li>Estos comandos aunque parezca que lo mandan al usuario creado en
vagrant, no es asi. Lo que hacen es guardarlo en el mismo pc desde donde
estas ejcutando el comando (localhost).</li>
</ul>
<div class="sourceCode" id="cb45"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="op">&lt;</span>nombre_del_archivo<span class="op">&gt;</span> alexteje@localhost:/tmp</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> <span class="op">&lt;</span>nombre_del_directorio<span class="op">&gt;</span> alexteje@localhost:/tmp</span></code></pre></div>
<h2 id="practica-1.12.-split">Practica 1.12. Split</h2>
<ol type="1">
<li>Descargamos unas fotos y las guardamos en el directorio fotos</li>
</ol>
<div class="sourceCode" id="cb46"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> fotos</span></code></pre></div>
<ol start="2" type="1">
<li>Calculamos y guardamos los hash de todas las fotos</li>
</ol>
<pre class="hash"><code>cd fotos
sha256sum * &gt; hashes_almacenados.txt</code></pre>
<ul>
<li>Esto creara los hashes de sha-256 de cada foto y los metera en un
txt llamado hashes_almacenados</li>
</ul>
<ol start="3" type="1">
<li>Comprimimos el directorio donde estas las imagenes</li>
</ol>
<div class="sourceCode" id="cb48"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-czvf</span> fotos_comprimidas.tgz fotos/</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-czvf</span> mi_directorio.tgz mi_directorio/</span></code></pre></div>
<ul>
<li>Siendo fotos_comprimidas el nombre del nuevo fichero creado
(compresion de fotos) y fotos/, el fichero original que hemos
comprimido</li>
</ul>
<ol start="4" type="1">
<li>Trocearemos el fichero en ficheros mas pequeños de por ejemplo 1
MB</li>
</ol>
<div class="sourceCode" id="cb49"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span> <span class="at">-b</span> 1M fotos_comprimidas.tgz trozos_fotos_comprimidas_</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span> <span class="at">-b</span> 1M mi_directorio.tgz parte_ </span></code></pre></div>
<ul>
<li>Donde parte_ se refiere al nombre que recibiran los trozos del
archivo, en este caso los trozos en los que se divide el directorio
fotos_comprimidas, se llamaran trozos_fotos_comprimidas_aa,
trozos_fotos_comprimidas_ab…</li>
</ul>
<ol start="5" type="1">
<li>Para copiar los trozos al directorio /tmp de vbox01 debemos:</li>
</ol>
<div class="sourceCode" id="cb50"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> trozos_fotos_comprimidas_<span class="pp">*</span> vagrant@10.0.2.15:/tmp</span></code></pre></div>
<ul>
<li>Con el * hacemos que se envien todos los archivos que tengan el
nombre trozos_fotos_comprimidas_…</li>
</ul>
<ol start="6" type="1">
<li>Para recomponer los trozos en vbox01 debemos:</li>
</ol>
<div class="sourceCode" id="cb51"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> up</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="ex">vagrant</span> ssh</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> trozos_fotos_comprimidas_<span class="pp">*</span> <span class="op">&gt;</span> fotos_reconstruidas.tgz</span></code></pre></div>
<ul>
<li><p>Con el cat anterior crearemos un fichero tar llamado
fotos_reconstruidas</p></li>
<li><p>Para extraer los ficheros del fichero anterior, debemos:</p></li>
</ul>
<div class="sourceCode" id="cb52"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xzvf</span> fotos_reconstruidas.tgz</span></code></pre></div>
<ol start="7" type="1">
<li>Para calcular los hashes de los ficheros y comprobar que son
identicos a los originales, deberemos en /tmp de vbox01 sacar las fotos
de fotos_recostruidas a una carpeta llamada fotos y comprobarlos:</li>
</ol>
<div class="sourceCode" id="cb53"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp/fotos</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sha256sum</span> <span class="pp">*</span> <span class="op">&gt;</span> hashes_extraidos.txt</span></code></pre></div>
<ul>
<li>Extraemos los hashes en un fichero, y comprobamos</li>
</ul>
<div class="sourceCode" id="cb54"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span> hashes_almacenados.txt hashes_extraidos.txt</span></code></pre></div>
<ul>
<li>Si no existen diferencias el comando diff no mostrara nada, en caso
contrario mostrara las diferencias entre los hashes</li>
</ul>
<h2 id="practica-1.13.-rsync">Practica 1.13. Rsync</h2>
<ol type="1">
<li>El primer paso sera el envio de un directorio local a una maquina
remota, para ello he hecho:</li>
</ol>
<div class="sourceCode" id="cb55"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_rsync</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> Archivo_prueba.md</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Archivo_prueba.md <span class="at">--</span><span class="op">&gt;</span> Para añadir contenido</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> Prueba_rsync alexteje@f-l3109-pc07.aulas.eif.urjc.es:~/Escritorio</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> /directorio_local usuario@maquina_remota:/directorio_remoto <span class="at">--</span><span class="op">&gt;</span> Comando ejecutado</span></code></pre></div>
<ul>
<li>De esta manera estoy enviando el fichero Prueba_rsync al escritorio
de la maquina virtual. Si en el comando pongo PRueba_rsync/, esto hace
que se envien los contenidos de dentro del fichero sueltos</li>
</ul>
<ol start="2" type="1">
<li>Para hacerlo al contrario, es decir, de la maquina virtual a la
maquina virtual haremos esto pero desde la <strong>maquina
local</strong>:</li>
</ol>
<div class="sourceCode" id="cb56"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> alexteje@f-l3109-pc07.aulas.eif.urjc.es:~/Escritorio/Prueba_rsync ~/Desktop</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> usuario_remoto@ip_remota:/ruta/directorio_remoto /ruta/destino_local</span></code></pre></div>
<ul>
<li>De esta forma conseguimos copiar el direcotrio entero en la maquina
local. Aqui al igual que antes, si solo queremos los contenidos del
fichero y no el fichero haremos /ruta/directorio_remoto/, importante el
/ del final.</li>
</ul>
<ol start="3" type="1">
<li>Consulta la pagina del manual, elige tres opciones y comprueba que
se comportan como deben.</li>
</ol>
<ul>
<li>Si ejecutamos man rsync veremos todas las opciones de rsync.</li>
<li><strong>Delete</strong>: (Elimina archivos en el destino que no
están en el origen)</li>
</ul>
<div class="sourceCode" id="cb57"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--delete</span> /ruta/directorio_local usuario_remoto@ip_remota:/ruta/destino_remoto</span></code></pre></div>
<ul>
<li><strong>Exlude</strong>: (Excluye archivo del envio)</li>
</ul>
<div class="sourceCode" id="cb58"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--exclude</span> <span class="st">&#39;archivo_o_directorio_a_excluir&#39;</span> /ruta/directorio_local usuario_remoto@ip_remota:/ruta/destino_remoto</span></code></pre></div>
<ul>
<li><strong>Progress</strong>: (Para ver el progreso de la
sincronizacion)</li>
</ul>
<div class="sourceCode" id="cb59"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--progress</span> /ruta/directorio_local usuario_remoto@ip_remota:/ruta/destino_remoto</span></code></pre></div>
<h2 id="practica-1.14.-freefilesync">Practica 1.14. FreeFileSync</h2>
<ul>
<li>Para esta practica crearemos ambas carpetas en el ordenador local o
el ordenador virutal, da igual ya que el usuario es el mismo en ambos, y
podemos acceder desde uno u otro:</li>
</ul>
<div class="sourceCode" id="cb60"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/simula_labo/lagrs</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/simula_casa/lagrs</span></span></code></pre></div>
<ul>
<li>De forma que las sincronizaremos ambas y cuando estemos en los
laboratorios trabajaremos en la carpeta simula_lab, y cuando estemos en
el ordenador local trabajaremos en el directorio simula_casa. Asi
tendriamos siempre todo actualizado.</li>
<li>Tendriamos que darle una sincronizacion en modo espejo, para poder
actualizar de un lado a otro.</li>
<li>En este caso he creado una prueba en simula_labo y al darle a
sincronizar ocurre lo siguiente:</li>
</ul>
<figure>
<img src="images/Sincro_ffs.png" alt="Sincronizacion FreeFileSync" />
<figcaption aria-hidden="true"><strong>Sincronizacion
FreeFileSync</strong></figcaption>
</figure>
<ul>
<li>Simula casa tiene la direcion del pc de casa y simula labo la
direccion de un pc, auqnue podrian tener la misma direccion del un solo
pc, hay que el usuario es el mismo.</li>
</ul>
<h2 id="practica-1.15.-conflicto-con-freefilesync">Practica 1.15.
Conflicto con FreeFileSync</h2>
<ul>
<li>Un conflito se genera cuando editas el mismo archivo en dos
dsipositivos sin haberlo sin cronizado antes.</li>
<li>Un <strong>ejemplo</strong> es: Si el archivo base se llama P1, en
un ordenador tu has añadido algo se convierte en P1 + x y si lo haces en
el otro seria P1 + y, de forma que FreeFileSync no sabe cual es el
adecuado y te genera este conflicto</li>
<li>La unica forma de resolverlo en guardando uno de los dos con su
contenido, por lo que estas perdiendo la informacion o de x o de y. No
es una buena forma de usar FreeFileSync.</li>
<li>Por eso es conveniente sincronizar cada vez que cambias de
dispositivo.</li>
</ul>
<h2 id="practica-1.16.-sincronización-real-de-tu-cuenta">Practica 1.16.
Sincronización real de tu cuenta</h2>
<ul>
<li>Despues de descargar FreeFileSync he sincronizado las carpetas lagrs
creadas.</li>
<li>Mi dispositvo personal esta conectado a traves de:</li>
</ul>
<div class="sourceCode" id="cb61"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> alexteje@f-l3109-pc07.aulas.eif.urjc.es</span></code></pre></div>
<h2 id="practica-1.17.-localizacion-de-procesos">Practica 1.17.
Localizacion de procesos</h2>
<ol type="1">
<li>Para comparar los nombres de estos programas lo que haremos sera
guardar los nombres en un fichero, luego abrire una app (gedit), volvere
a guardar los nombres en otro fichero y los comparare.</li>
</ol>
<div class="sourceCode" id="cb62"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span> <span class="at">-ef</span> <span class="op">&gt;</span> procesos_antes.txt</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gedit</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ps</span> <span class="at">-ef</span> <span class="op">&gt;</span> procesos_despues.txt</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span> procesos_antes.txt procesos_despues.txt</span></code></pre></div>
<ul>
<li>De esta forma si han ocurrido cambios, diff nos los mostrara. Donde
no hayan ocurrido cambios no mostrara nada.</li>
</ul>
<h2 id="practica-1.18.-invocacion-de-la-shell">Practica 1.18. Invocacion
de la shell</h2>
<ol type="1">
<li>El bashrc se ejecuta solamente en las shells interactivas que no son
de login.</li>
</ol>
<ul>
<li>Cuando tu inicias una terminal se esta ejecutando al bshrc.</li>
<li>Cuando una shell es de login, como su <usuario>, se esta ejecutando
el bash_profile perteneciente a ese usuario.</li>
</ul>
<ol start="2" type="1">
<li>Abriremos el bashrc (en este caso he probado en el ordenador local)
y añadiremos una traza, de forma que si lo hemos hecho correctamente
cada vez que abramos una terminal deberia ejecutarse ese comando.
Haremos lo siguiente:</li>
</ol>
<div class="sourceCode" id="cb63"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> ~/.bashrc</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;¡Bienvenido al terminal remoto, alexteje!&quot;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc <span class="at">--</span><span class="op">&gt;</span> Es neccesario actualizar, a veces no funciona, probamos cambiando de terminal</span></code></pre></div>
<ul>
<li>Una vez añadido y guardado, abrimos una nueva terminal y vemos
que:</li>
</ul>
<figure>
<img src="images/echo_bashrc.png" alt="echo_bashrc" />
<figcaption aria-hidden="true"><strong>echo_bashrc</strong></figcaption>
</figure>
<ol start="3" type="1">
<li>De primeras en las cuentas de laboratorio no existe el bash_profile,
por lo que deberemos crearlo con:</li>
</ol>
<div class="sourceCode" id="cb64"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> ~/.bash_profile</span></code></pre></div>
<ul>
<li>una vez creado haremos que bash_profile llame a bashrc añadiendo
estas lineas de codigo en bash_profile:</li>
</ul>
<div class="sourceCode" id="cb65"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> ~/.bashrc <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">.</span> ~/.bashrc</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<ol start="4" type="1">
<li><p>Cuando entramos a un usuario mediante <strong>su
<usuario></strong> se ejecuta una shell de login ya que esta pidiendo la
contraseña del usuario en cuestion, de forma que pasa a ejecutarse el
bash_profile de dicho usuario.</p></li>
<li><p>Para añadir alias en el bashrc se haria de esta manera:</p></li>
</ol>
<div class="sourceCode" id="cb66"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> c=<span class="st">&#39;clear&#39;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> ~/.bashrc <span class="at">--</span><span class="op">&gt;</span> Si no funciona cambio de terminal</span></code></pre></div>
<ul>
<li>Como tenemos redireccionado el bash_profile de laboratorio al
bashrc, los alias debemos ponerlos en bashrc.</li>
<li>En caso de que no este redireccionado y tengamos alias en los dos
bash (rc y profile), funcionaria ambos alias</li>
</ul>
<h2 id="practica-1.19.-instalacion-de-docker">Practica 1.19. Instalacion
de Docker</h2>
<ul>
<li>Para realizar la instalacion de Docker debemos realizar los
siguiente pasos para ver que actualizaciones hay disponibles y
descargarlas:</li>
</ul>
<div class="sourceCode" id="cb67"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> update</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> upgrade <span class="at">-y</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> install docker.io</span></code></pre></div>
<ul>
<li>Para comprobar que la instalacion es correcta lanzaremos el hola
mundo.</li>
<li>Para ello debemos crear un grupo docker e introducir el usuario que
creamos en su momento (alexte).Para ello haremos lo siguiente:</li>
</ul>
<div class="sourceCode" id="cb68"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> add group docker</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> adduser alexteje docker</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">groups</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span> Lanzamos holamundo</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run debian echo <span class="st">&quot;Hola mundo&quot;</span></span></code></pre></div>
<ul>
<li>Quiza al lanzar el docker run debian echo necesite la instalacion,
esto solo pasa cuando se hace por primera vez, luego ya se ejecuta sin
problema alguno.</li>
</ul>
<h2 id="practica-1.20.-uso-basico-de-imagenes">Practica 1.20. Uso basico
de imagenes</h2>
<ol type="1">
<li>Para crear un contenedor interactivo sin nombre del tipo ubuntu
24.04 debemos hacer el siguiente comando <strong>desde el usuario creado
(su alexteje)</strong>:</li>
</ol>
<div class="sourceCode" id="cb69"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> ubuntu</span></code></pre></div>
<ul>
<li>Alguna ordenes que podemos ejecutar es lc,echo “Texto”…</li>
<li>Alguna de las ordenes que no podemos ejecutar son</li>
</ul>
<ol start="2" type="1">
<li>Para crear un contendor con el nombre alexc01 debemos ejecutar lo
siguiente:</li>
</ol>
<div class="sourceCode" id="cb70"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> NOMBRE_DOCKER ubuntu</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> alexc01 ubuntu </span></code></pre></div>
<ul>
<li>Si quisieramos que cambiar el nombre del hostname seria:</li>
</ul>
<div class="sourceCode" id="cb71"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> NOMBRE_DOCKER <span class="at">-h</span> NOMBRE_HOSTNAME ubuntu</span></code></pre></div>
<ol start="3" type="1">
<li>Las ordenes para listar los contenedores y las imagenes son:</li>
</ol>
<div class="sourceCode" id="cb72"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps      <span class="at">--</span><span class="op">&gt;</span> Contenedores interactivos <span class="er">(</span><span class="ex">activos</span><span class="kw">)</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span>   <span class="at">--</span><span class="op">&gt;</span> Contenedores <span class="er">(</span><span class="ex">incluye</span> los detenidos<span class="kw">)</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images  <span class="at">--</span><span class="op">&gt;</span> Imagenes</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm <span class="op">&lt;</span>x<span class="op">&gt;</span>  --<span class="op">&gt;</span> Elimina el contedor x <span class="er">(</span><span class="ex">x</span> = <span class="at">--name</span> x<span class="kw">)</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> stop <span class="op">&lt;</span>x<span class="op">&gt;</span>--<span class="op">&gt;</span> Pausa el contenedor x <span class="er">(</span><span class="ex">x</span> = <span class="at">--name</span> x<span class="kw">)</span></span></code></pre></div>
<figure>
<img src="images/dockerrm.png" alt="Ejemplo de docker ps-a y rm" />
<figcaption aria-hidden="true"><strong>Ejemplo de docker ps-a y
rm</strong></figcaption>
</figure>
<ul>
<li>Al realizar estos comandos veremos los detalles de los contenedores
o de las imagenes (status,name,port…)</li>
</ul>
<ol start="4" type="1">
<li>Para pausar el contenedor ejecutaremos:</li>
</ol>
<div class="sourceCode" id="cb73"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Ctrl</span> + dD</span></code></pre></div>
<ul>
<li>Para ver los contenedores e imagenes detenidas usaremos el segundo y
tercer comando del punto 3.</li>
</ul>
<ol start="5" type="1">
<li>Para comprobar que el sistema de ficheros del contenedor no es
persistente hare dos pruebas:</li>
</ol>
<ul>
<li><strong>Creaccion, suspense del contenedor y conexion</strong></li>
</ul>
<div class="sourceCode" id="cb74"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> alexc01 <span class="at">-h</span> alejandro ubuntu</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> prueba.md</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dokcer</span> ps <span class="at">-a</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> start alexc01</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> attach alexc01</span></code></pre></div>
<ul>
<li><p>En este caso el contenedor no ha sido borraod, sino apagado y
vuelto a encender, por lo que el archivo persiste.</p></li>
<li><p><strong>Creacion, eliminacion y creacion</strong></p></li>
</ul>
<div class="sourceCode" id="cb75"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> alexc01 <span class="at">-h</span> alejandro ubuntu</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> prueba.md</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dokcer</span> ps <span class="at">-a</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm alexc01</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> alexc01 <span class="at">-h</span> alejandro ubuntu</span></code></pre></div>
<ul>
<li>Ahora el contenido del contedor si se ha eliminado.</li>
</ul>
<h2 id="practica-1.21.-creacion-de-una-imagen-de-un-contenedor">Practica
1.21. Creacion de una imagen de un contenedor</h2>
<ol type="1">
<li>Primero crearemos una cuenta en docker hub para poder subir nuestras
imagenes ademas de poder coger otras que sean publicas.</li>
<li><strong>Prepararemos la imagen</strong> alexteje/banner para ello
haremos lo siguiente dentro de vbo01:</li>
</ol>
<div class="sourceCode" id="cb76"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> context</span></code></pre></div>
<ul>
<li>Y dentro de context haremos</li>
</ul>
<div class="sourceCode" id="cb77"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Dockerfile</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> entrypoint.sh</span></code></pre></div>
<ul>
<li>Rellenaremos estos dos ultimos archivos con el siguiente
contenido:</li>
</ul>
<div class="sourceCode" id="cb78"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="ex">DOCKERFILE</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:24.04</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> sysvbanner</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT.SH</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> bienvenido</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> a</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> <span class="va">$HOSTNAME</span></span></code></pre></div>
<ul>
<li><strong>Datos importantes</strong>: El dockerfile se suele tocar
menos que el entrypoint. En el dockerfile hay que poner si necesitamos
instalar algun paquete(sysvbanner) mientras que en el entrypoint
pondremos lo “comandos” que ejecutara la shell. <strong>lo haremos en
vbox01, asi que podremos acceder desde /vagrant en la maquina
virtual</strong>.</li>
</ul>
<ol start="3" type="1">
<li>Una vez tenemos preparada la imagen necesitamos <strong>lanzar el
contenedor</strong>. Primero conprobaremos que el entrypoint funciona
haciendo:</li>
</ol>
<div class="sourceCode" id="cb80"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./entrypoint.sh</span> <span class="at">---</span><span class="op">&gt;</span> En el fichero al que pertenezca</span></code></pre></div>
<p>docker</p>
<ul>
<li>Para lanzar el contenedor haremos en /vagrant (Ya que ahi se situa
el directorio context):</li>
</ul>
<div class="sourceCode" id="cb81"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> alexteje/banner context </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> contenedorP21 <span class="at">-h</span> hostP21 alexteje/banner</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> NombreContenedor <span class="at">-h</span> NombreHost NombreImagen</span></code></pre></div>
<ul>
<li>Deberiamos ver por pantalla que se ejecuta lo que teniamos en el
entrypoint.sh.</li>
<li><strong>RECORDAR</strong> que si modificas el entrypoint debes
borrar el contenedor de la imagen y crearlo de nuevo.</li>
</ul>
<div class="sourceCode" id="cb82"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm NombreContendor</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> alexteje/banner context</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> contenedorP21 <span class="at">-h</span> hostP21 alexteje/banner</span></code></pre></div>
<ol start="4" type="1">
<li>Para una vez lanzada la imagen no solo muestr ele banner sino
tambien abra una shell, debemos cambiar el entrypoint, para ello
añadiremos esto:</li>
</ol>
<div class="sourceCode" id="cb83"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> bienvenido</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> a</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> <span class="va">$HOSTNAME</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<ol start="5" type="1">
<li>Al modificiar el entrypoint debemos borrar el contenedor y volver a
lanzarlo como he expecificado al final del apartado
<ol start="3" type="1">
<li></li>
</ol></li>
</ol>
<div class="sourceCode" id="cb84"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> alexteje/banner context</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--name</span> contenedorP21 <span class="at">-h</span> hostP21 alexteje/banner</span></code></pre></div>
<ul>
<li>Al ejecutar esto se emitira el banner y seguira una shell con el
nombre:</li>
</ul>
<div class="sourceCode" id="cb85"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="ex">root@hostP21</span></span></code></pre></div>
<ol start="6" type="1">
<li>Para subir el contenedor a docker hub debemos hacer:</li>
</ol>
<div class="sourceCode" id="cb86"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push alexteje/banner</span></code></pre></div>
<ul>
<li>Al hacer el login nos pedira el usuario y contraseña de docker hub,
se introduce y se hace un push para subir la imagen.</li>
</ul>
<h2 id="pracitca-1.22-creacion-de-una-imagen-personalizada">Pracitca
1.22 Creacion de una imagen personalizada</h2>
<ol type="1">
<li>Para que el paquete cal este instalado en cada maquina virtual que
iniciemos debemos añadirlo en el provisionamineto (Vagrantfile).</li>
</ol>
<div class="sourceCode" id="cb87"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install <span class="at">-y</span> ncal</span></code></pre></div>
<ol start="2" type="1">
<li>Crearemos las carpetas y archivos necesarios en la carpeta vbox01 y
en /vagrant de la maquina virtual, ya que estan conectados.</li>
</ol>
<div class="sourceCode" id="cb88"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/construye.sh</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/lanza_jpercal01.sh</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/lanza_jpercal02.sh</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/context</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/context/Dockerfile</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cal/context/entrypoint.sh</span></span></code></pre></div>
<ul>
<li>Asi debe quedar en vbox01, recuerda que los directorios se crean con
mkdir NombreDirecotrio, y los ficheros con touch Nombre.md o vi
Nombre.sh</li>
</ul>
<ol start="3" type="1">
<li>Ahora rellenaremos los ficheros, especificaciones:</li>
</ol>
<ul>
<li><p>construye.sh —&gt; Script para construir la imagen
alexteje/cal</p></li>
<li><p>lanza_alexcal01.sh —&gt; Script para lanzar el contendor
alexcal01</p></li>
<li><p>lanza_alexcal02.sh —&gt; Script para lanzar el contendor
alexcal02</p></li>
<li><p>Dockerfile —&gt; Especificaciones de la imagen y paquetes a
instalar</p></li>
<li><p>entrypoint.sh —&gt; Comandos que ejecutara la shell</p></li>
<li><p>Para ejecutar el script debemos dar permisos de escritura a todos
los scripts:</p></li>
</ul>
<div class="sourceCode" id="cb89"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x NombreScript.sh</span></code></pre></div>
<ul>
<li>Una vez dado permisos debemos ejecutar de la siguiente manera:</li>
</ul>
<div class="sourceCode" id="cb90"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/cal</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexcal01.sh</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexcal02.sh</span> <span class="at">---</span><span class="op">&gt;</span> De momento hace lo mismo que el 01</span></code></pre></div>
<p>-Cada contenedor se lanza desde su carpeta en vagrant, en este caso
<strong>TODO</strong> desde cd /vagrant/cal.</p>
<ul>
<li><strong>CONTENIDO DE LOS SCRIPTS:</strong></li>
</ul>
<ol type="1">
<li>construye.sh</li>
</ol>
<div class="sourceCode" id="cb91"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tu login aquí</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="va">LOGIN</span><span class="op">=</span>alexteje</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir la imagen con el nombre de usuario y nombre de imagen</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$LOGIN</span><span class="st">/cal&quot;</span> context</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Prueba: #!/bin/bash</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> tulogin/cal ~/lagrs/vbox01/cal/context</span></code></pre></div>
<ol start="2" type="1">
<li>lanza_alexcal0X.sh</li>
</ol>
<div class="sourceCode" id="cb92"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-h</span> alexcal01 <span class="at">--name</span> alexcal01 <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>alexteje/cal</span></code></pre></div>
<ol start="3" type="1">
<li>Dockerfile</li>
</ol>
<div class="sourceCode" id="cb93"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:24.04</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> ncal</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<ol start="4" type="1">
<li>entrypoint.sh</li>
</ol>
<div class="sourceCode" id="cb94"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Esto ejecuta el calendario</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cal</span></span></code></pre></div>
<h2 id="practica-1.23.-montaje-bind">Practica 1.23. Montaje Bind</h2>
<ol type="1">
<li>El nombre de la imagen a crear sera:</li>
</ol>
<div class="sourceCode" id="cb95"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alexteje/bind</span> </span></code></pre></div>
<ol start="2" type="1">
<li>Creamos la carpeta remoto dentro de vbox01, y dentro crearemos los
siguientes ficheros:</li>
</ol>
<div class="sourceCode" id="cb96"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/bind/construye.sh</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/bind/lanza_alexbind01.sh</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/bind/context/Dockerfile</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/bind/context/entrypoint.sh</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>Preparacion de la imagen:</strong></li>
</ol>
<ul>
<li>Debemos añadir al Dockerfile la instalacion del editor de texto vim,
asi como el sysvbanner para la traza de prueba de funcionamiento que he
puesto. Para que el contenedor ejecute una shell debemos añadir en el
entrypoint:</li>
</ul>
<div class="sourceCode" id="cb97"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<ul>
<li>Por ultimo para que el contenedor monte el directorio /tmp/test de
vbox01 en el directorio /tmp/test del contenedor debemos crear el
directorio test/ desde la shell que nos ejecute el contendor, creando
dentro un archivo que se vera en el vbox01 si añadimos esta linea en el
lanza_alexbind01.sh</li>
</ul>
<div class="sourceCode" id="cb98"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> /tmp/test:/tmp/test <span class="dt">\</span></span></code></pre></div>
<ul>
<li>Esto hara que el directorio tmp del contenedor se vuelque tambien en
el directorio tmp de vbox01.</li>
</ul>
<ol start="4" type="1">
<li>Una vez rellenados todos los ficheros debemos darle permisos de
ejecucion a los .sh</li>
</ol>
<div class="sourceCode" id="cb99"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x fichero.sh</span></code></pre></div>
<ol start="5" type="1">
<li>Ejecucion del contenedor:</li>
</ol>
<div class="sourceCode" id="cb100"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/bind</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images <span class="at">--</span><span class="op">&gt;</span> Comprobacion de la creacion de la imagen </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexbind01.sh</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span><span class="op">&gt;</span> Lanza nueva shell</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> test</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> hola_jperez</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span><span class="op">&gt;</span> Añades contenido a hola_jperez</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span>, exit.. hasta llegar a usuario vagrant</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /tmp/test/hola_jperez </span></code></pre></div>
<ul>
<li><p>Si todo ha ido correctamente se deberia pintar por pantalla el
contenido del fichero hola_jperez</p></li>
<li><p><strong>Permisos usuarios individuales:</strong></p></li>
<li><p>Una que te salgas del terminal creado por el contenedor, los
permisos del fichero creado seran solo de lectura, si tu ejecutas: ls
-l, saldra esto:</p></li>
</ul>
<div class="sourceCode" id="cb101"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-rw-r--r--</span> 1 root root 13 Dec  5 12:26 hola</span></code></pre></div>
<ul>
<li>Para poder darle permisos a tu cuenta para poder escribir debermos
hacer desde alexteje@vbox01:/tmp/test$:</li>
</ul>
<div class="sourceCode" id="cb102"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown alexteje:alexteje /tmp/test/hola</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="ex">total</span> 4</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="ex">-rw-r--r--</span> 1 alexteje alexteje 13 Dec  5 12:26 hola</span></code></pre></div>
<ul>
<li><p>De forma que desde el usuario alexteje podremos escribir y
veremos tanto en el contenedor como en el usuario el contenido
actualizado</p></li>
<li><p>Ademas de que el fichero y el contenido es persistente, una vez
que cierras el contenedor y vuelves a abrir seguira ahi. Sin embargo, si
apagas la maquina virtual el directorio test permanecera pero el fichero
hola_jperez se habra borrado, debido a que el directorio /tmp es un
directorio temporal.</p></li>
<li><p>Si otro usuario no puede editarlo, como en este caso ahora
pertenece al usuario alexteje, el usuario vagrant no podria. Bastaria
con escribir:</p></li>
</ul>
<div class="sourceCode" id="cb103"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown vagrant:vagrant /tmp/test/hola</span></code></pre></div>
<ul>
<li><strong>Permisos para todos los usuarios:</strong></li>
<li>Para que todos los usuarios puedar editar este fichero desde su
/tmp, deremos ir a uno de ellos y ejecutar:</li>
</ul>
<div class="sourceCode" id="cb104"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod o+w /tmp/test/hola</span></code></pre></div>
<ul>
<li><p>De este forma cualquiera podra editar el contenido del archivo, y
desde todos se podra ver el contenipdo actualizado</p></li>
<li><p><strong>Contenido de los ficheros:</strong></p></li>
</ul>
<ol type="1">
<li>construye.sh</li>
</ol>
<div class="sourceCode" id="cb105"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tu login aquí</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="va">LOGIN</span><span class="op">=</span>alexteje</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir la imagen con el nombre de usuario y nombre de imagen</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$LOGIN</span><span class="st">/bind&quot;</span> context</span></code></pre></div>
<ol start="2" type="1">
<li>lanza_alexbind0X.sh</li>
</ol>
<div class="sourceCode" id="cb106"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-h</span> alexbind01 <span class="at">--name</span> alexbind01 <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>-v /tmp/test:/tmp/test <span class="dt">\</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>alexteje/bind</span></code></pre></div>
<ol start="3" type="1">
<li>Dockerfile</li>
</ol>
<div class="sourceCode" id="cb107"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:24.04</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> vim sysvbanner</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<ol start="4" type="1">
<li>entrypoint.sh</li>
</ol>
<div class="sourceCode" id="cb108"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Traza de funcionamiento</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> funciona</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Ejecutar la shell</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<h2 id="practica-1.24.-conectividad-entre-contenedores">Practica 1.24.
Conectividad entre contenedores</h2>
<ol type="1">
<li>El nombre de la imagen que crearemos mas adelante sera:</li>
</ol>
<div class="sourceCode" id="cb109"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alexteje/remoto</span></span></code></pre></div>
<ol start="2" type="1">
<li>Creamos la carpeta remoto dentro de vbox01, y dentro crearemos los
siguientes ficheros:</li>
</ol>
<div class="sourceCode" id="cb110"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/remoto/construye.sh</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/remoto/lanza_alexremoto01.sh</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/remoto/lanza_alexremoto02.sh</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/remoto/context/Dockerfile</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/remoto/context/entrypoint.sh</span></span></code></pre></div>
<ol start="3" type="1">
<li><strong>Preparacion de la imagen:</strong></li>
</ol>
<ul>
<li>Para que el contenedor ejecute el demonio servidor ssh, debemos
añadirlo a la instalacion en el Dockerfile (openssh-server).</li>
<li>Para poder relaizar el ifconfig y el ping debemos instalarlo tambien
(net-tools)</li>
<li>Tambien he añadido el paquete inetutils-ping, aunque no seria
neccesario ya que el propio sistema tiene la posibilidad de realizar
pings sin la instalacion de este paquete.</li>
</ul>
<ol start="4" type="1">
<li><p>El contenedor tendra un usuario con privilegios, por lo que
debemos añadirlo al Dockerfile para que se cree al lanzar el
contenedor</p></li>
<li><p><strong>Contenido de todos los ficheros:</strong></p></li>
</ol>
<ul>
<li>Una vez rellenados todos los ficheros debemos darle permisos a los
ficheros .sh</li>
</ul>
<div class="sourceCode" id="cb111"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x fichero.sh</span></code></pre></div>
<ol start="6" type="1">
<li><p>Abrimos dos terminales ejecutando vbox01 (vagrant up, vagrant
ssh) y lanzamos los dos contenedores (lanza_alexremoto@.sh), haremos
ifconfig en ambos y miraremos la direccion ip de ambos. La direccion ip
se encuentra en el apartado inte de 172.17.0.2 eth0.</p></li>
<li><p>Pasos a seguir:</p></li>
</ol>
<div class="sourceCode" id="cb112"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/remoto</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images <span class="at">--</span><span class="op">&gt;</span> Para comprobar que se ha creado la imagen</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexremoto01.sh</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="ex">-</span> Se iniciara un terminal</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="ex">ifconfig</span></span></code></pre></div>
<p>En otro terminal de vbox01 haremos:</p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/remoto</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexremoto02.sh</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> <span class="op">&lt;</span>Direccion inet eth0 del otro terminal vbox01<span class="op">&gt;</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Ctrl+C</span></span></code></pre></div>
<ul>
<li>Una vez acabado el envio de paquetes comprobamos que se han enviado
y ejecutamos:</li>
</ul>
<div class="sourceCode" id="cb114"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> netstat <span class="at">-tupan</span></span></code></pre></div>
<ul>
<li><p>Explicacion de las siglas: -t: Muestra las conexiones TCP. -u:
Muestra las conexiones UDP. -p: Muestra el proceso y su ID (PID)
asociado con cada conexión. -a: Muestra todos los sockets activos,
incluidas las conexiones en espera (listening) y las conexiones
establecidas. -n: Muestra las direcciones y puertos de forma numérica
(sin resolver nombres de host o de servicios).</p></li>
<li><p>Para ejecutar el comando anterior nos pedira una contraseña que
sera la creada en el Dockerfile junto al usuario</p></li>
<li><p>Este comando nos ayuda a identificar conexiones activas y ver que
procesos se estan escuchando y en que puertos especificos</p></li>
</ul>
<figure>
<img src="images/netstat.png" alt="Ejemplo netstat -tupan" />
<figcaption aria-hidden="true"><strong>Ejemplo netstat
-tupan</strong></figcaption>
</figure>
<ol start="8" type="1">
<li>Para acceder a otro pc desde esta terminal, deberemos mirar el inet
(eth0) del pc al que queremos acceder y ejecutar:</li>
</ol>
<div class="sourceCode" id="cb115"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> alexteje@inet</span></code></pre></div>
<ul>
<li><p>La contraseña que nos pedira sera la creada en el Dockerfile, al
crear y dar privelegios al usuario</p></li>
<li><p><strong>Contenido de los archivos</strong></p></li>
</ul>
<ol type="1">
<li>construye.sh</li>
</ol>
<div class="sourceCode" id="cb116"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define tu login aquí</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="va">LOGIN</span><span class="op">=</span>alexteje</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir la imagen con el nombre de usuario y nombre de imagen</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$LOGIN</span><span class="st">/remoto&quot;</span> context</span></code></pre></div>
<ol start="2" type="1">
<li>lanza_alexremoto0X.sh</li>
</ol>
<div class="sourceCode" id="cb117"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-h</span> alexremoto01 <span class="at">--name</span> alexremoto01 <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>alexteje/remoto</span></code></pre></div>
<ol start="3" type="1">
<li>Dockerfile</li>
</ol>
<div class="sourceCode" id="cb118"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:24.04</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Instalaciones</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> sudo net-tools inetutils-ping openssh-server sysvbanner</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> service ssh start</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Creacion usuario</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> useradd <span class="at">-rm</span> <span class="at">-d</span> /home/alexteje <span class="at">-s</span> /bin/bash <span class="at">-u</span> 1001 alexteje <span class="at">-g</span> root <span class="at">-G</span> sudo </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> echo <span class="st">&#39;alexteje:Alejandro&#39;</span> <span class="kw">|</span> <span class="ex">chpasswd</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="ex">EXPOSE</span> 22</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<ol start="4" type="1">
<li>entrypoint.sh</li>
</ol>
<div class="sourceCode" id="cb119"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/sbin/sshd</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> funciona</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<ul>
<li><strong>Importante conocer:</strong></li>
<li>El usuario se crea, se le da permisos y se le asigna contraseña en
el Dockerfile</li>
<li>Los paquetes a instalar tambien se añaden en el Dockerfile</li>
<li>El lanzamiento de la terminal una vez lanzado la imagen se pone en
el entrypoint con</li>
</ul>
<div class="sourceCode" id="cb120"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<h2 id="practica-1.25.-sshfs">Practica 1.25. Sshfs</h2>
<ul>
<li>En el directorio tmp de la maquina virtual crearemos una carpeta que
se llamara labo, basicamente:</li>
</ul>
<div class="sourceCode" id="cb121"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> labo</span></code></pre></div>
<ul>
<li>Con el comando que ejecutaremos a continuacion lo que estamos
haciendo sera copiar todo el contenido del pc que seleccionemos, de
forma que si editamos en la maquina virtual tambien se editara en el pc
original, y viceversa.</li>
</ul>
<div class="sourceCode" id="cb122"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sshfs</span> alexteje@f-l3103-pc03: /tmp/labo</span></code></pre></div>
<ul>
<li>Si sale un error de que el comando not found, se debe a que no
tenemos instalado el paquete de sshfs:</li>
</ul>
<div class="sourceCode" id="cb123"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt install <span class="at">-y</span> sshfs</span></code></pre></div>
<ul>
<li>Siendo alexteje el usuario del pc original, y /tmp/labo la direccion
donde se copiara todo el contenido.</li>
</ul>
<p><strong>Comandos de eliminacion:</strong> <strong>MUCHO CUIDADO PQ SE
BORRA EL CONTENIDO DEL ORDENADOR ORIGINAL:</strong> - Para eliminar la
carpeta montada debemos primero desmontar y ya luego eliminar:</p>
<div class="sourceCode" id="cb124"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fusermount</span> <span class="at">-u</span> /tmp/labo</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> rm <span class="at">-r</span> labo <span class="er">(</span><span class="ex">No</span> se si funcionara sin sudo<span class="kw">)</span></span></code></pre></div>
<h2 id="practica-1.26.-contenedor-con-sshfs">Practica 1.26. Contenedor
con sshfs</h2>
<ol type="1">
<li>El nombre de la imagen que crearemos mas adelante sera:</li>
</ol>
<div class="sourceCode" id="cb125"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alexteje/cssh</span></span></code></pre></div>
<ol start="2" type="1">
<li>Creamos la carpeta remoto dentro de vbox01, y dentro crearemos los
siguientes ficheros:</li>
</ol>
<div class="sourceCode" id="cb126"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cssh/construye.sh</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cssh/lanza_alexcssh01.sh</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cssg/context/Dockerfile</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/cssh/context/entrypoint.sh</span></span></code></pre></div>
<ol start="3" type="1">
<li>Una vez rellenados todos los ficheros debemos darle permisos de
ejecucion a los .sh</li>
</ol>
<div class="sourceCode" id="cb127"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x fichero.sh</span></code></pre></div>
<ol start="4" type="1">
<li><strong>Importante:</strong> Debemos crear las dos carpetas a
sincronizar con sshfs con mkdir.</li>
</ol>
<ul>
<li>Una en el ordenador local, donde meteremos algo de cotenido:</li>
</ul>
<div class="sourceCode" id="cb128"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_sshfs</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Prueba1</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Prueba2</span></code></pre></div>
<ul>
<li>Y otra en el <strong>tmp del contendor</strong>, es decir,
ejecutaremos el construye y el lanza.</li>
</ul>
<div class="sourceCode" id="cb129"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/cssh</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexcssh01.sh</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_sshfs_contenedor</span></code></pre></div>
<ul>
<li>Una vez estemos en la shell que nos lanza el entrypoint
haremos:</li>
</ul>
<div class="sourceCode" id="cb130"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_sshfs</span></code></pre></div>
<ol start="5" type="1">
<li>Para comprobar que sshfs esta descargado en la maquina virtual
ejecutaremos:</li>
</ol>
<div class="sourceCode" id="cb131"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sshfs</span> <span class="at">-V</span></span></code></pre></div>
<ol start="6" type="1">
<li>Ejecuccion del contenedor:</li>
</ol>
<div class="sourceCode" id="cb132"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span><span class="op">&gt;</span> Creas carpetas en local y en contenedor</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/cssh</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexcssh01.sh</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="ex">sshfs</span> alexteje@f-l3109-pc05:/Direcion_Carpeta_Local /Direccion_Carpeta_Contenedor</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /Direcion_Carpeta_Local</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span><span class="op">&gt;</span> Si salen los archivos aqui es que ha ido correctamente</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> /Direccion_Carpeta_Contenedor/testfile </span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span><span class="op">&gt;</span> Te vas al pc05 y ves si se te ha creado el archivo testfile, si es que si,</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="ex">todo</span> correcto</span></code></pre></div>
<ol start="7" type="1">
<li>Para hacer lo mismo pero desde el usuario creado en el Dockerfile
debemos tener la carpeta con archivos en el ordendor remoto.</li>
</ol>
<div class="sourceCode" id="cb133"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_sshfs</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Prueba1</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vi</span> Prueba2</span></code></pre></div>
<ul>
<li>Y tambien debemos crear la carpeta en el /tmp del usuario iniciado
desde la shell del contenedor:</li>
</ul>
<div class="sourceCode" id="cb134"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="kw">```</span><span class="fu">bash</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/cssh</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye.sh</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexcssh01.sh</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp</span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> Prueba_sshfs_alexteje</span></code></pre></div>
<ul>
<li>Luego ejecutaremos:</li>
</ul>
<div class="sourceCode" id="cb135"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="ex">sshfs</span> alexteje@f-l3109-pc08:/Direcion_Carpeta_Local /Direccion_Carpeta_Contenedor <span class="at">--</span><span class="op">&gt;</span> Comando general</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="ex">sshfs</span> alexteje@f-l3109-pc08:/tmp/Prueba_sshfs /tmp/Prueba_sshfs_alexteje </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /tmp/Prueba_sshfs_alexteje </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span><span class="op">&gt;</span> Deberan salir los archivos del directorio /tmp/Prueba_sshfs del pc08</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> /tmp/Prueba_sshfs_alexteje/TESTFILE2</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="ex">--</span><span class="op">&gt;</span> Si miras con ls en /tmp/Prueba_sshfs deberia aparecer TESTFILE2, como un archivo mas.</span></code></pre></div>
<ul>
<li><p><strong>Solucion de posibles errores:</strong></p></li>
<li><p>Si nos dice <strong>permission denegated</strong> sera por lo los
permisos de la carperta, haces id en alexteje o en root para ver que a
grupos pertenece y ejecutas:</p></li>
</ul>
<div class="sourceCode" id="cb136"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span> <span class="at">---</span><span class="op">&gt;</span> Para ver los grupos <span class="er">(</span><span class="ex">pertenece</span> al grupo root debido al Dockerfile<span class="kw">)</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown alexteje:root /tmp/Virtual_contenedor/</span></code></pre></div>
<ul>
<li><p>Si ocurre algun error esta bien comprobar que ssh funciona (no
sshfs) conectandose a una maquina y viendo si salta algun error o
funciona correctamente</p></li>
<li><p><strong>Contenido de los archivos:</strong></p></li>
</ul>
<ol type="1">
<li>construye.sh:</li>
</ol>
<div class="sourceCode" id="cb137"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="va">USERNAME</span><span class="op">=</span>alexteje</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="va">IMAGE_NAME</span><span class="op">=</span><span class="st">&quot;</span><span class="va">${USERNAME}</span><span class="st">/cssh&quot;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="va">$IMAGE_NAME</span> context/</span></code></pre></div>
<ol start="2" type="1">
<li>lanza_alexcssh01.sh:</li>
</ol>
<div class="sourceCode" id="cb138"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="va">CONTAINER_NAME</span><span class="op">=</span><span class="st">&quot;alexcssh01&quot;</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="va">HOSTNAME</span><span class="op">=</span><span class="st">&quot;alexcssh01&quot;</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="va">IMAGE_NAME</span><span class="op">=</span><span class="st">&quot;alexteje/cssh&quot;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--rm</span> <span class="at">--name</span> <span class="va">$CONTAINER_NAME</span> <span class="dt">\</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">--hostname</span> <span class="va">$HOSTNAME</span> <span class="dt">\</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">--privileged</span> <span class="dt">\</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">--device</span> /dev/fuse <span class="dt">\</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">--cap-add</span> SYS_ADMIN <span class="dt">\</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">--security-opt</span> apparmor:unconfined <span class="dt">\</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">$IMAGE_NAME</span></span></code></pre></div>
<ol start="3" type="1">
<li>Dockerfile:</li>
</ol>
<div class="sourceCode" id="cb139"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:20.04</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración del idioma</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> LANG es_ES.UTF-8</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> LANGUAGE es_ES:es</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ENV</span> LC_ALL es_ES.UTF-8</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="ex">apt-get</span> install <span class="at">-y</span> locales <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">locale-gen</span> es_ES.UTF-8 <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="ex">update-locale</span> LANG=es_ES.UTF-8</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalación de sshfs y otras herramientas</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt-get install <span class="at">-y</span> sshfs sudo vim openssh-server</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación del usuario</span></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="ex">ARG</span> USERNAME=alexteje</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> useradd <span class="at">-m</span> <span class="at">-s</span> /bin/bash <span class="va">$USERNAME</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$USERNAME</span><span class="st">:</span><span class="va">$USERNAME</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="ex">chpasswd</span> <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb139-18"><a href="#cb139-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">usermod</span> <span class="at">-aG</span> sudo <span class="va">$USERNAME</span></span>
<span id="cb139-19"><a href="#cb139-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-20"><a href="#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuración del SSH</span></span>
<span id="cb139-21"><a href="#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> mkdir /var/run/sshd</span>
<span id="cb139-22"><a href="#cb139-22" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /entrypoint.sh</span>
<span id="cb139-23"><a href="#cb139-23" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> chmod +x /entrypoint.sh</span>
<span id="cb139-24"><a href="#cb139-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-25"><a href="#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<ol start="4" type="1">
<li>entrypoint.sh</li>
</ol>
<div class="sourceCode" id="cb140"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Iniciar el servicio SSH</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="ex">service</span> ssh start</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mensaje de bienvenida</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Contenedor configurado con éxito. Usuario: </span><span class="va">$USERNAME</span><span class="st">&quot;</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Mantener el contenedor activo</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<h2 id="practica-1.27.-contenedor-con-fichero-hosts">Practica 1.27.
Contenedor con fichero hosts</h2>
<ol type="1">
<li>El nombre de la imagen que crearemos mas adelante sera:</li>
</ol>
<div class="sourceCode" id="cb141"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alexteje/chosts</span></span></code></pre></div>
<ol start="2" type="1">
<li>Creamos la carpeta remoto dentro de vbox01, y dentro crearemos los
siguientes ficheros:</li>
</ol>
<div class="sourceCode" id="cb142"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/chosts/construye.sh</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/chosts/lanza_alexchosts01.sh</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/chosts/lanza_alexchosts02.sh</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/chosts/context/Doackerfile</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="ex">~/lagrs/vbox01/chosts/context/entrypoint.sh</span></span></code></pre></div>
<ol start="3" type="1">
<li>Para que los contenedores conozcan las direcciones ip de las d
maquinas del laboratorio crearemos el fichero delta_hosts, en el cual
introduciremos las direcciones ip encontradas en el fichero /etc/hosts,
de esta forma</li>
</ol>
<div class="sourceCode" id="cb143"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="ex">view</span> /etc/hosts touch</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">touch</span> ~/lagrs/vbox01/chosts/context/delta_hosts</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span><span class="op">&gt;</span> Copiar las direcciones que consideremos</span></code></pre></div>
<ul>
<li>Contenido de delta_hosts:</li>
</ul>
<div class="sourceCode" id="cb144"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.52</span>  Maquina8</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.53</span>  Maquina9</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.54</span>  Maquina10</span></code></pre></div>
<ol start="4" type="1">
<li>Para que este fichero aparezca en el /tmp/ de la imagen debemos
añadirlo al Dockerfile como:</li>
</ol>
<div class="sourceCode" id="cb145"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> delta_hosts /tmp/delta_hosts</span></code></pre></div>
<ol start="5" type="1">
<li>Debemos hacer que cada vez que se inicie la imagen, se
<strong>añadan</strong> estas entradas al /etc/hosts del contenedor.
Para ello debemos añadir esto en el entrypoint:</li>
</ol>
<div class="sourceCode" id="cb146"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /tmp/delta_hosts <span class="op">&gt;&gt;</span> /etc/hosts</span></code></pre></div>
<ul>
<li><strong>Recordatorio importante:</strong> En docker no es posible
borrar ni reemplazar el fichero /etc/hosts de una imagen, pero sí puedes
modificarlo añadiendo entradas</li>
</ul>
<ol start="6" type="1">
<li>Para poder hacer ifconfig, ping y ssh debemos instalar los paquetes
neccesarios, los cuales los añadiremos en el Dockerfile:</li>
</ol>
<div class="sourceCode" id="cb147"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> sudo net-tools inetutils-ping openssh-server sysvbanner</span></code></pre></div>
<ol start="7" type="1">
<li>Importante la creacion de todos los archivos correctamente y
<strong>darles permisos neccesarios</strong>, en este caso solo debemos
dar permisos a los .sh, para poder ejecutar.</li>
</ol>
<div class="sourceCode" id="cb148"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x archivo.sh</span></code></pre></div>
<ol start="8" type="1">
<li>Pasos a seguir para la ejecucion del ping de un contenedor a un pc
del laboratorio:</li>
</ol>
<div class="sourceCode" id="cb149"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /vagrant/chosts</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./construye</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./lanza_alexchosts01.sh</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span><span class="op">&gt;</span> Se abrira nuevo terminal</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-a</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /tmp/</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> delta_hosts</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> <span class="op">&lt;</span>NombreAsigandoEnDeltaHosts<span class="op">&gt;</span></span></code></pre></div>
<ol start="9" type="1">
<li>Pasos a seguir para entrar por ssh desde un contenedor a un
ordenador del laboratorio:</li>
</ol>
<ul>
<li>Desde el terminal que se abre al ejecutar el script
lanza_alexchosts.sh</li>
</ul>
<div class="sourceCode" id="cb150"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> alexteje@Maquina8</span></code></pre></div>
<ul>
<li><p>Te pedira confirmar el fingerprint con yes (Primera vez que
inicies sesion en esa maquina), y la contraseña de la respectiva
maquina, en este caso de la cuenta de linux del laboratorio.</p></li>
<li><p><strong>Contenido de los archivos: </strong></p></li>
</ul>
<ol type="1">
<li>Construye.sh</li>
</ol>
<div class="sourceCode" id="cb151"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="va">LOGIN</span><span class="op">=</span>alexteje</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Construir la imagen con el nombre de usuario y nombre de imagen</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build <span class="at">-t</span> <span class="st">&quot;</span><span class="va">$LOGIN</span><span class="st">/chosts&quot;</span> context</span></code></pre></div>
<ol start="2" type="1">
<li>Lanza_alexchosts0X.sh</li>
</ol>
<div class="sourceCode" id="cb152"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">-h</span> alexchosts01 <span class="at">--name</span> alexchosts01 <span class="at">--rm</span> <span class="dt">\</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>alexteje/chosts</span></code></pre></div>
<ol start="3" type="1">
<li>DockerFile</li>
</ol>
<div class="sourceCode" id="cb153"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="ex">FROM</span> ubuntu:24.04</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Instalaciones</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> apt update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> upgrade <span class="at">-y</span> <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install <span class="at">-y</span> sudo net-tools inetutils-ping openssh-server sysvbanner</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> service ssh start</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Creacion usuario</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> useradd <span class="at">-rm</span> <span class="at">-d</span> /home/alexteje <span class="at">-s</span> /bin/bash <span class="at">-u</span> 1001 alexteje <span class="at">-g</span> root <span class="at">-G</span> sudo</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="ex">RUN</span> echo <span class="st">&#39;alexteje:Alejandro&#39;</span> <span class="kw">|</span> <span class="ex">chpasswd</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> delta_hosts /tmp/delta_hosts</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="ex">COPY</span> entrypoint.sh /</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="ex">EXPOSE</span> 22</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="ex">ENTRYPOINT</span> <span class="pp">[</span><span class="st">&quot;/entrypoint.sh&quot;</span><span class="pp">]</span></span></code></pre></div>
<ol start="4" type="1">
<li>entrypoint.sh</li>
</ol>
<div class="sourceCode" id="cb154"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/sbin/sshd</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Traza de funcionamiento</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="ex">banner</span> funciona</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Aparecera en el tmp de la imagen</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /tmp/delta_hosts <span class="op">&gt;&gt;</span> /etc/hosts</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Lanzar terminal </span></span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="fu">su</span> alexteje</span>
<span id="cb154-12"><a href="#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="ex">/bin/bash</span></span></code></pre></div>
<ol start="5" type="1">
<li>Delta_hosts</li>
</ol>
<div class="sourceCode" id="cb155"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.52</span>  Maquina8</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.53</span>  Maquina9</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="ex">212.128.254.54</span>  Maquina10</span></code></pre></div>
</body>
</html>
